<!DOCTYPE html>
<html>

<head>
	<title>Now where Was I?</title>
	<link href="https://fonts.googleapis.com/css?family=Acme" rel="stylesheet">
	<link rel="stylesheet" href="index.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js"></script>
	

	<script>
		$(document).ready(function(){
			var myInterval = setInterval(getJson, 5000);
			var placelist = [];
			getJson();

			$('#postButton').click(function() {
				window.location.href = 'create.html';
				return false;
			});

			$('#placeInput').on('input', function() {
				console.log($("#placeInput").val())
				if($("#placeInput").val() == ""){
					$("#mylist").empty();
					$("#mylist").append(
						placelist.map(place => {
							var mylink = $("<a style='font-size:16px;'>").text(place);
							mylink.attr("href", "place.html?place=" + place);
							return $("<div class='item'></div>").append(mylink);
						})
					)
				}
				else{
					$("#mylist").empty();
					var searchplacelist = [];
					for(var i = 0; i < placelist.length; i++){
						if(placelist[i].includes($("#placeInput").val())){
							searchplacelist.push(placelist[i]);
						}
					}

					$("#mylist").append(
						searchplacelist.map(place => {
							var mylink = $("<a style='font-size:16px;'>").text(place);
							mylink.attr("href", "place.html?place=" + place);
							return $("<div class='item'></div>").append(mylink);
						})
					)
				}
			});
			
			function getJson(){
				console.log("getson")
				if(placelist.length == 0){
					$.getJSON("https://desolate-castle-53665.herokuapp.com/thoughts", function(data, status){
						$("#mylist").empty();

						var origplacelist = [];
						for(var i = 0; i < data._embedded.thoughts.length; i++){
							origplacelist.push(data._embedded.thoughts[i].place);
						}
						placelist = Array.from(new Set(origplacelist));

						$("#mylist").append(
							placelist.map(place => {
								var mylink = $("<a style='font-size:16px;'>").text(place);
								mylink.attr("href", "place.html?place=" + place);
								return $("<div class='item'></div>").append(mylink);
							})
						)
					})
				}
				else{
					clearInterval(myInterval);
				}
			}
		})

		
	</script>

</head>
<body style="background-color: #f7fffd;">
	<div align="center">
		<br>
		<h1 style="font-family: 'Acme', sans-serif; font-size:40px;">Now where Was I?</h1>
		<br><br><br>
		<h3 style="font-size:20px;">Where are you right now?</h3>
		<p style="font-size:14px;">Enter the location where you forgot what you were going to do.</p>
		<br><br>

		<form class="myform">
			<div class="ui input"><input type="text" name="place" id="placeInput" style="background-color: #effffb;"></div>
		</form>
		<br>

		<div style="width:300px" class="ui relaxed divided list" id="mylist">
			<h5>Loading items...</h5>
		</div>
		<br><br><br><br><br>
		<p style="font-size:14px;">If you would like to post a realization that you have often, or just had,</p>
		<button class="ui button" id="postButton" style="background-color: #d6ecff;">
			Post it here!
		</button>
	</div>
</body>
</html>