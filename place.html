<!DOCTYPE html>
<html>

<head>
	<title>Now where Was I?</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	

	<script>

		$(document).ready(function(){
			function getUrlVars()
			{
				var vars = [], hash;
			    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
				for(var i = 0; i < hashes.length; i++)
				{
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				}
				return vars;
			}

			var place = getUrlVars()["place"];

			$.getJSON("https://desolate-castle-53665.herokuapp.com/thoughts/search/findAllByPlace?place=" + place, function(data, status){
				var origthoughtlist = [];
				for(var i = 0; i < data._embedded.thoughts.length; i++){
					origthoughtlist.push(data._embedded.thoughts[i].thought);
				}
				var thoughtlist = Array.from(new Set(origthoughtlist));

				$(".mylist").append(
					thoughtlist.map(thought => {
						var mythought = $("<h4>").text(thought);
						return $("<li>").append(mythought);
					})
				)
			})


			$(".timeselect").change(function(event) {
				var serialized = $(this).serializeArray();
				event.preventDefault();

				$.getJSON("https://desolate-castle-53665.herokuapp.com/thoughts/search/findAllByPlace?place=" + place, function(data, status){
					var origthoughtlist = [];
					for(var i = 0; i < data._embedded.thoughts.length; i++){
						if(Number(serialized[0].value) == -1 || (data._embedded.thoughts[i].time - Number(serialized[0].value)) <= 2 || data._embedded.thoughts[i].time == -1){
							origthoughtlist.push(data._embedded.thoughts[i].thought);
						}
					}
					var thoughtlist = Array.from(new Set(origthoughtlist));

					$(".mylist").append(
						thoughtlist.map(thought => {
							var mythought = $("<h4>").text(thought);
							return $("<li>").append(mythought);
						})
					)
				})
			});
		})
	</script>

</head>
<body>
	<h1 align="center">Now where Was I?</h1>

	<br><br>
	
	<form>
		<div><select name="time" class="timeselect">
			<option value=-1>Any time</option>
			<option value=0>12 AM</option>
			<option value=1>1 AM</option>
			<option value=3>2 AM</option>
			<option value=4>3 AM</option>
			<option value=5>4 AM</option>
			<option value=6>5 AM</option>
			<option value=7>6 AM</option>
			<option value=8>7 AM</option>
			<option value=9>8 AM</option>
			<option value=10>9 AM</option>
			<option value=11>10 AM</option>
			<option value=12>11 AM</option>
			<option value=13>12 PM</option>
			<option value=14>1 PM</option>
			<option value=15>2 PM</option>
			<option value=16>3 PM</option>
			<option value=17>4 PM</option>
			<option value=18>5 PM</option>
			<option value=19>6 PM</option>
			<option value=20>7 PM</option>
			<option value=21>8 PM</option>
			<option value=22>9 PM</option>
			<option value=13>10 PM</option>
			<option value=24>11 PM</option>
		</select></div>
	</form>

	<ul class="mylist"></ul>
</body>
</html>