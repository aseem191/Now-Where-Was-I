<!DOCTYPE html>
<html>

<head>
	<title>Now where Was I?</title>
	<link href="https://fonts.googleapis.com/css?family=Acme" rel="stylesheet">
	<link rel="stylesheet" href="index.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js"></script>
	

	<script>
		var timelist = ["12 AM", "1 AM", "2 AM", "3 AM", "4 AM", "5 AM", "6 AM", "7 AM", "8 AM", "9 AM", "10 AM", "11 AM", "12 PM", "1 PM", "2 PM", "3 PM", "4 PM", "5 PM", "6 PM", "7 PM", "8 PM", "9 PM", "10 PM", "11 PM"];
		timelist[-1] = "any time";

		$(document).ready(function(){
			$('#backButton').click(function() {
				window.location.href = 'index.html';
				return false;
			});


			function getUrlVars()
			{
				var vars = [], hash;
			    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
				for(var i = 0; i < hashes.length; i++)
				{
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				}
				return vars;
			}

			var place = decodeURIComponent(getUrlVars()["place"]);


			$("#placeText").text("What you may have forgotten about at the " + place + ":");

			$.getJSON("https://desolate-castle-53665.herokuapp.com/thoughts/search/findAllByPlace?place=" + place, function(data, status){
				$("#mylist").empty();

				var origthoughtlist = [];
				for(var i = 0; i < data._embedded.thoughts.length; i++){
					origthoughtlist.push({thought: data._embedded.thoughts[i].thought, time: timelist[data._embedded.thoughts[i].time]});
				}
				var thoughtlist = Array.from(new Set(origthoughtlist));

				$("#mylist").append(
					thoughtlist.map(thought => {
						var mythought = $("<h4>").text(thought.thought);
						var mytime = $("<div style='width:300px' class='ui relaxed divided list'></div>").append($("<h6>").text("Realization made at " + thought.time + "."))
						return $("<div class='item'></div>").append(mythought).append(mytime);
					})
				)
			})


			$("#timeselect").change(function(event) {
				$("#mylist").empty();
				var serialized = $(this).serializeArray();
				event.preventDefault();

				$.getJSON("https://desolate-castle-53665.herokuapp.com/thoughts/search/findAllByPlace?place=" + place, function(data, status){
					var origthoughtlist = [];
					for(var i = 0; i < data._embedded.thoughts.length; i++){
						if(Number(serialized[0].value) == -1 || Math.abs(data._embedded.thoughts[i].time - Number(serialized[0].value)) <= 2 || data._embedded.thoughts[i].time == -1){
							origthoughtlist.push({thought: data._embedded.thoughts[i].thought, time: timelist[data._embedded.thoughts[i].time]});
						}
					}
					var thoughtlist = Array.from(new Set(origthoughtlist));

					$("#mylist").append(
						thoughtlist.map(thought => {
							var mythought = $("<h4>").text(thought.thought);
							var mytime = $("<div style='width:300px' class='ui relaxed divided list'></div>").append($("<h6>").text("Realization made at " + thought.time + "."))
							return $("<div class='item'></div>").append(mythought).append(mytime);
						})
					)
				})
			});
		})
	</script>

</head>
<body style="background-image: url('bgImage.png'); background-position: center top;">
	<div align="center">
		<br><br>
		<h1 style="font-family: 'Acme', sans-serif; font-size:40px;">Now Where Was I?</h1>

		<br><br>

		<h4 id="placeText"></h4>
		<br>
		
		<form>
			<div><select class="ui dropdown" name="time" id="timeselect" style="background-color: #effffb;">
				<option value=-1>Any time</option>
				<option value=0>12 AM</option>
				<option value=1>1 AM</option>
				<option value=3>2 AM</option>
				<option value=4>3 AM</option>
				<option value=5>4 AM</option>
				<option value=6>5 AM</option>
				<option value=7>6 AM</option>
				<option value=8>7 AM</option>
				<option value=9>8 AM</option>
				<option value=10>9 AM</option>
				<option value=11>10 AM</option>
				<option value=12>11 AM</option>
				<option value=13>12 PM</option>
				<option value=14>1 PM</option>
				<option value=15>2 PM</option>
				<option value=16>3 PM</option>
				<option value=17>4 PM</option>
				<option value=18>5 PM</option>
				<option value=19>6 PM</option>
				<option value=20>7 PM</option>
				<option value=21>8 PM</option>
				<option value=22>9 PM</option>
				<option value=13>10 PM</option>
				<option value=24>11 PM</option>
			</select></div>
		</form>
		<br>

		<div style="width:300px" class="ui relaxed divided list" id="mylist">
			<h5>Loading thoughts...</h5>
		</div>
		<br><br>

		<button class="ui button" id="backButton" style="background-color: #d6ecff;">
			Go back
		</button>
		<br><br><br>
	</div>
</body>
</html>