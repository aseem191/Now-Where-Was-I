<!DOCTYPE html>
<html>

<head>
	<title>Now where Was I?</title>
	<link href="https://fonts.googleapis.com/css?family=Acme" rel="stylesheet">
	<link rel="stylesheet" href="index.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js"></script>

	<script>
		$(document).ready(function(){
			var placelist = [];

			$(document).on('click', ".mylink", function()
			{
				console.log($(this).text());
				$("#placeInput").val($(this).text());
			});

			$("#placeInput").focus(function(){
				$("#successText").text("");
				$.getJSON("https://desolate-castle-53665.herokuapp.com/thoughts", function(data, status){
					var origplacelist = [];
					for(var i = 0; i < data._embedded.thoughts.length; i++){
						origplacelist.push(data._embedded.thoughts[i].place);
					}
					placelist = Array.from(new Set(origplacelist));

					$("#mylist").append(
						placelist.map(place => {
							var mylink = $("<a style='font-size:16px;' class='mylink'></a>").text(place);
							return $("<div class='item'></div>").append(mylink);
						})
					)
				})
			})

			$("#placeInput").blur(function(){
				setTimeout(function(){
					$("#mylist").empty();
				}, 100);
			})


			$("#thoughtInput").focus(function(){
				$("#successText").text("");
			})

			$('#placeInput').on('input', function() {
				console.log($("#placeInput").val())
				if($("#placeInput").val() == ""){
					$("#mylist").empty();
					$("#mylist").append(
						placelist.map(place => {
							var mylink = $("<a style='font-size:16px;' class='mylink'></a>").text(place);
							return $("<div class='item'></div>").append(mylink);
						})
					)
				}
				else{
					$("#mylist").empty();
					var searchplacelist = [];
					for(var i = 0; i < placelist.length; i++){
						if(placelist[i].includes($("#placeInput").val())){
							searchplacelist.push(placelist[i]);
						}
					}

					$("#mylist").append(
						searchplacelist.map(place => {
							var mylink = $("<a style='font-size:16px;' class='mylink'></a>").text(place);
							return $("<div class='item'></div>").append(mylink);
						})
					)
				}
			});

			$('#backButton').click(function() {
				window.location.href = 'index.html';
				return false;
			});

			$(".myform").submit(function(event) {
				var serialized = $(this).serializeArray();
				event.preventDefault();

				var postdata = {
					thought: serialized[2].value,
					place: serialized[0].value.toLowerCase(),
					time: Number(serialized[1].value),
				}

				console.log( JSON.stringify(postdata) );

				if(serialized[2].value == "" || serialized[0].value == ""){
					$("#successText").text("One or more fields is left blank. Try again.")
					return;
				}

				$("#successText").text("Submitting thought...")
				$.ajax({
					url: "https://desolate-castle-53665.herokuapp.com/postrequest",
					type: "POST",
					data: JSON.stringify(postdata),
					contentType: "application/json; charset=utf-8",
					dataType: "json",
					success: function(){
						console.log("posted");
					},
					complete: function(jqXHR, textStatus) {
						$("#successText").text("Submission complete")
					}
				})
			});
		})
		
	</script>

</head>
<body style="background-image: url('bgImage.png'); background-position: center top;">
	<br>
	<div style="padding-left: 25px;"><button class="ui button" id="backButton" style="background-color: #d6ecff;">
		Go back
	</button></div><br>
	<div align="center">
		<h1 style="font-family: 'Acme', sans-serif; font-size:40px;">Now Where Was I?</h1>
		<br><br><br>

		<form class="myform">
			<h4>Enter the location where you came up with this realization:</h4>
			<div class="ui input"><input type="text" name="place" id="placeInput" style="background-color: #effffb;"></div>
			<div style="width:300px" class="ui relaxed divided list" id="mylist"></div>
			<br><h4>Enter the time at which you came to this realization:</h4>
			<div><select class="ui dropdown" name="time" style="background-color: #effffb;">
				<option value=-1>Any time</option>
				<option value=0>12 AM</option>
				<option value=1>1 AM</option>
				<option value=3>2 AM</option>
				<option value=4>3 AM</option>
				<option value=5>4 AM</option>
				<option value=6>5 AM</option>
				<option value=7>6 AM</option>
				<option value=8>7 AM</option>
				<option value=9>8 AM</option>
				<option value=10>9 AM</option>
				<option value=11>10 AM</option>
				<option value=12>11 AM</option>
				<option value=13>12 PM</option>
				<option value=14>1 PM</option>
				<option value=15>2 PM</option>
				<option value=16>3 PM</option>
				<option value=17>4 PM</option>
				<option value=18>5 PM</option>
				<option value=19>6 PM</option>
				<option value=20>7 PM</option>
				<option value=21>8 PM</option>
				<option value=22>9 PM</option>
				<option value=13>10 PM</option>
				<option value=24>11 PM</option>
			</select></div>
			<br><h4>Enter your realization:</h4>
			<div class="ui input"><input type="text" name="thought" id="thoughtInput" style="width:400px; background-color: #effffb;"></div>
			<br><br><br>
			<div><input type="submit" value="Submit" class="ui button" style="background-color: #d6ecff;"></div>
		</form>

		<h3 id="successText"></h3>

		<br><br>

		
	</div>
</body>
</html>